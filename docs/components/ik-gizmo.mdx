---
title: "IkGizmo"
description: "Interactive IK target with PivotControls"
icon: "arrows-up-down-left-right"
---

A draggable 3D gizmo (powered by drei's PivotControls) that drives inverse kinematics. Drag the gizmo to move the robot's end-effector. Must be a descendant of `<IkController>`.

## Usage

```tsx
<IkController config={{ siteName: 'tcp', numJoints: 7 }}>
  <IkGizmo />
</IkController>
```

### Custom Site

Override the site tracked by this gizmo (defaults to the IkController's `siteName`):

```tsx
<IkController config={{ siteName: 'tcp', numJoints: 7 }}>
  <IkGizmo siteName="left_hand" scale={0.25} />
</IkController>
```

### Custom Drag Handler

```tsx
<IkGizmo
  onDrag={(pos, quat) => {
    // Consumer handles the response — IK is NOT auto-enabled
    console.log('Target:', pos, quat);
  }}
/>
```

## Props

<ParamField body="siteName" type="string" default="IkController's siteName">
  MuJoCo site to track and solve IK towards. Defaults to the parent `IkController`'s configured site.
</ParamField>

<ParamField body="scale" type="number" default="0.18">
  Visual scale of the gizmo handles.
</ParamField>

<ParamField body="onDrag" type="(pos: THREE.Vector3, quat: THREE.Quaternion) => void">
  Custom drag callback. When provided, the gizmo does **not** automatically enable IK — the consumer is responsible for handling the drag.
</ParamField>

## Behavior

**When not dragging:**
- The gizmo tracks the MuJoCo site's world position and orientation each frame
- It "follows" the end-effector as the robot moves

**When dragging (no `onDrag` prop):**
- IK is automatically enabled via `useIk().setIkEnabled(true)`
- The gizmo's position/orientation is written to the IK target
- The IK solver runs each frame to compute joint angles
- OrbitControls are disabled during drag

**When dragging (with `onDrag` prop):**
- The `onDrag` callback fires with position and quaternion
- IK is NOT automatically enabled — the consumer decides what to do
- OrbitControls are disabled during drag

## Programmatic Control

Use the `useIk()` hook from any component inside `<IkController>`:

```tsx
const { setIkEnabled, moveTarget, syncTargetToSite } = useIk();

// Animate the gizmo to a position over 500ms
moveTarget(new THREE.Vector3(0.5, 0, 0.3), 500);

// Snap the gizmo to current site position
syncTargetToSite();

// Enable/disable IK solving
setIkEnabled(true);
```

## Notes

- Must be a descendant of `<IkController>` — will throw if used outside
- The IK solver respects `numJoints` from the IkController config
- Disable IK with `useIk().setIkEnabled(false)` when using custom control (e.g., `useBeforePhysicsStep`)
